# VGA-Framebuffer(v. 2.0)
ФБ с кистью для рисования

Реализован на плате OMDAZZ с чипом Cyclone IV E: EP4CE10E22C8

# Содержание
[- Краткое описание папок](#краткое-описание-папок)

[- Описание дизайна](#описание-дизайна)

[- Предполагаемый алгоритм работы с фреймбуфером](#предполагаемый-алгоритм-работы-с-фреймбуфером)

# Краткое описание папок
- assets - файлы изображений для данного руководства
- bitstreams - набор готовых програмных файлов для загрузки на ПЛИС.
	- FrameBuffer_with_Brush.sof - текущий дизайн
- modelsim - папка проектов ModelSim для отладки дизайна
	- Brush_TB.mpf - проект отладочной симуляции работы кисти (только спрайт, без записи в память)
	- DEBOUNCER.mpf - проект отладочной симуляции модуля антидребезга кнопок
	- FIFO_Test.mpf - проект отладочной симуляции работы ФИФО
	- MEM_Tb.mpf - проект отладочной симуляции работы модуля памяти
	- MEM-BRUSH.mpf - проект отладочной симуляции работы кисти с памятью
	- TOP_Tb.mpf - проект отладочной симуляции всего фреймбуфера
- quartus - рабочая папка проекта Quartus
- src - папки с файлами-исходниками 
	- brush - папка с файлами кисти
	- debouncer - папка с файлами модуля антидребезга
	- fifo - папка с файлами ФИФО
	- memory - папка с файлами модуля памяти
	- memsyncreset - папка с файлом модуля синхронного сброса памяти
	- pll - папка с файлами IP-модуля ФАПЧ
	- rom - папка с файлами модуля ROM
	- top - папка с файлами верхних модулей проекта
	- vga - папка с файлом модуля VGA
# Описание дизайна
Проект по рисованию на экране с помощью кисти. По сути, является демонстрацией использования фреймбуфера в составе большего проекта. Кисть представляет собой квадратный спрайт определенного цвета(в диапазоне 3bit-RGB). Размер спрайта(а точнее половина длины стороны квадрата) может меняться в определенном диапазоне. Спрайт может перемещаться по всему экрану и раскрашивать область под собой. Параметры кисти можно менять с помощью кнопок на плате: 

RTL-схема верхнего уровня
![](/../ToCE2020LABS/assets/6.png)

## Особенности
- Разрешение данной версии кадрового буфера фиксированно и составляет 80x60.
- Разрешение экрана (пока) также фиксированно как 640x480.
- Буфер может осуществлять сброс памяти и перезапись изображения, в случае необходимости.
- Структурно память буфера является однопортовой памятью с произвольным доступом
- Алгоритм чтения и записи в кадровый буфер реализован по схеме "пинг-понг". Таким образом обновление изображение происходит в реальном времени.
- Максимальная частота обновления изображения: 781 Гц (1,28 мс/кадр).
- Память буфера расчитана на цветность VGA-RGB. Это позволяет хранить изображения с цветовым диапазоном до 7 цветов.

## Узкие места
- Из-за размера памяти и ее конфигурации, операция записи имеет латентность в 5 тактов, в то время как операция чтения - 1 такт.
- Низкого разрешения кадра хватает для экспериментальных целей и малых проектов, но обьективно мало для современной графики.
- Цветность изображения также обьективно мала.
- При наличии интерфейса выхода данных (VGA), отсутствует интерфейс входа. Из чего следует невозможность записи нового изображения после загрузки на ПЛИС.
- Модель однопортовой RAM, имитирующая работу графической памяти реальных видеоадаптеров, не в полной мере использует возможности блоков двухпортовой памяти внутри ПЛИС.

## Планы разработки.
- Реализация курсора-кисти, управляемого с кнопок платы OMDAZZ, способного закрашивать пиксели на экране. Также будет возможность менять размер кисти.

# Предполагаемый алгоритм работы с фреймбуфером
1. Открыть проект графического редактора в среде Visual Studio и запустить программу.
2. Нарисовать желаемое изображение
![](/../ToCE2020LABS/assets/1.png)
3. Открыть раздел "Файл"

![](/../ToCE2020LABS/assets/2.png)

3.5 (по желанию)Сохранить изображение в разрешении 80x60, выбрав функцию "Save"

![](/../ToCE2020LABS/assets/Smile80x60.tiff)

4. Сохранить сжатое изображение в палитре "RGB-3bit", выбрав функцию "SaveRGB"

![](/../ToCE2020LABS/assets/SmileRGB.tiff)

5. Конвертировать изображение в текстовый hex-файл и сохранить, выбрав функцию "SaveTXT-s"

![](/../ToCE2020LABS/assets/5.png)

6. Переместить(если нужно) hex-файл в папку проекта фреймбуфера, затем открыть файл ROM-модуля "ROM.v". Далее нужно отредактировать одну из строчек 39-47, раскомментировав ее и заменив старое имя hex-файла на имя hex-файла вашего изображения

![](/../ToCE2020LABS/assets/3.png)

7. Скомпиллировать проект и загрузить его на OMDAZZ, подключенный к монитору через VGA.
